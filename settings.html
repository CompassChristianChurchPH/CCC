<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CCC - Settings</title>
  <link rel="icon" href="assets/ccc-icon.png" type="image/png" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>
  <script src="firebase-config.js" type="module"></script>
</head>
<body>
  <header>
    <h1><img src="assets/ccc-icon.png" alt="CCC Icon"> Compass Christian Church</h1>
    <nav>
      <button onclick="location.href='home.html'">Home</button>
    </nav>
  </header>

  <main class="container">
    <h2>Settings</h2>
    <div class="button-group">
      <button onclick="showSection('changePass')">Change Pass</button>
      <button onclick="showSection('changeName')">Change Name</button>
      <button onclick="showSection('access')">Access</button>
    </div>

    <section id="changePass" class="hidden">
      <h3>Change Password</h3>
      <label for="currentPassword">Current Password</label>
      <input type="password" id="currentPassword" placeholder="Enter current password">

      <label for="newPassword">New Password</label>
      <input type="password" id="newPassword" placeholder="Enter new password">

      <label for="confirmNewPassword">Re-Enter New Password</label>
      <input type="password" id="confirmNewPassword" placeholder="Re-enter new password">

      <button onclick="verifyEmailAndPin('password')">Save</button>
    </section>

    <section id="changeName" class="hidden">
      <h3>Change Name</h3>
      <label for="firstName">First Name</label>
      <input type="text" id="firstName" placeholder="Enter first name">

      <label for="middleName">Middle Name</label>
      <input type="text" id="middleName" placeholder="Enter middle name">

      <label for="lastName">Last Name</label>
      <input type="text" id="lastName" placeholder="Enter last name">

      <button onclick="verifyEmailAndPin('name')">Save</button>
    </section>

    <section id="access" class="hidden">
      <h3>Access</h3>
      <label for="accessUsername">Username</label>
      <input type="text" id="accessUsername" placeholder="Enter username">

      <label for="accessPin">PIN</label>
      <input type="password" id="accessPin" placeholder="Enter PIN">

      <button onclick="verifyAccess()">Access</button>
    </section>
  </main>

  <!-- Modal for Email and PIN Verification -->
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3>Verification</h3>
      <label for="modalEmail">Email</label>
      <input type="email" id="modalEmail" placeholder="Enter email">

      <label for="modalPin">PIN</label>
      <input type="password" id="modalPin" placeholder="Enter PIN">

      <button onclick="submitVerification()">Submit</button>
    </div>
  </div>

  <script type="module">
    import { auth, db } from './firebase-config.js';

    // Function to show the selected section
    window.showSection = function(sectionId) {
      document.querySelectorAll('section').forEach(section => {
        section.classList.add('hidden');
      });
      document.getElementById(sectionId).classList.remove('hidden');
    };

    // Function to open the modal
    window.verifyEmailAndPin = function(action) {
      window.currentAction = action;
      document.getElementById('modal').classList.remove('hidden');
    };

    // Function to close the modal
    window.closeModal = function() {
      document.getElementById('modal').classList.add('hidden');
    };

    // Function to handle verification submission
    window.submitVerification = async function() {
      const email = document.getElementById('modalEmail').value;
      const pin = document.getElementById('modalPin').value;

      // Implement your verification logic here
      // For example, fetch user data from Firestore and compare PIN

      // After verification, perform the desired action
      if (window.currentAction === 'password') {
        // Update password logic
      } else if (window.currentAction === 'name') {
        // Update name logic
      }

      closeModal();
    };

    // Function to handle access verification
    window.verifyAccess = async function() {
      const username = document.getElementById('accessUsername').value;
      const pin = document.getElementById('accessPin').value;

      // Implement your access verification logic here
      // For example, check if the username and PIN match predefined credentials

      // If verified, redirect to access.html
      window.location.href = 'access.html';
    };
  </script>
</body>
</html>
